IF EXISTS (SELECT * FROM SYS.OBJECTS WHERE OBJECT_ID = OBJECT_ID(N'[ACC_IMPL].[CRT_SAT]') AND TYPE IN (N'U'))
BEGIN
	IF COL_LENGTH('ACC_IMPL.CRT_SAT','INCOME_SOURCE') IS NOT NULL
	BEGIN
        UPDATE sat
        SET sat.INCOME_SOURCE = '1'
        FROM ACC_IMPL.CRT_SAT sat
        INNER JOIN ACC_IMPL.CRT_HUB h
        	ON sat.CRT_HKEY = h.CRT_HKEY
        INNER JOIN BFX.UNIVERSAL_DOCUMENT ud
        	ON h.CERTIFICATE_NUMBER = ud.UNIVERSAL_DOCUMENT_NUMBER
        INNER JOIN ORG.APPLICATION_USER us
        	ON ud.SYS_CREATED_BY_ID = us.APPLICATION_USER_ID
        WHERE us.USERNAME = 'Bitrix'
    END
END

IF EXISTS (SELECT * FROM SYS.OBJECTS WHERE OBJECT_ID = OBJECT_ID(N'[ACC_IMPL].[CRT_SAT]') AND TYPE IN (N'U'))
BEGIN
	IF COL_LENGTH('ACC_IMPL.CRT_SAT','INCOME_SOURCE') IS NOT NULL
	BEGIN
        UPDATE sat
        SET sat.INCOME_SOURCE = '3'
        FROM ACC_IMPL.CRT_SAT sat
        WHERE sat.INCOME_SOURCE IS NULL
    END
END