SELECT sq.INV_PROFIT_RATE
FROM (
SELECT 
	iprof.INV_PROFIT_RATE,
	iprof.LOAD_DATE,
	iprof.INV_PROFIT_PAY_TYPE_CODE,
	iprof.INV_PROFIT_CALC_DATE,
	RANK() OVER (
		PARTITION BY iprof.INV_PROFIT_PAY_TYPE_CODE 
		ORDER BY iprof.LOAD_DATE DESC) AS [Rank]
FROM PAS_IMPL.INVESTMENT_PROFIT iprof
WHERE iprof.INV_PROFIT_CALC_DATE = @eventDate
    AND iprof.CONTRACT_NUMBER = @contractNumber
) AS sq
WHERE sq.INV_PROFIT_PAY_TYPE_CODE IN (@investProfitType) 
	AND sq.[Rank] = 1