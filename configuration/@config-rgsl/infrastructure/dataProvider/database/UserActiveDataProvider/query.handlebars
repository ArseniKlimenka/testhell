SELECT aucp.APPLICATION_USER_ID, sp.SERVICE_PROVIDER_ID, sp.SERVICE_PROVIDER_CODE, pty.PARTY_ID, aucp.VALUE PARTY_CODE, ps.FULL_NAME PARTY_FULL_NAME, aucpi.VALUE IS_USER_ACTIVE
FROM ORG.SERVICE_PROVIDER sp
LEFT JOIN ORG_IMPL.SERVICE_PROVIDER_HUB sph ON sph.SERVICE_PROVIDER_CODE = sp.SERVICE_PROVIDER_CODE
LEFT JOIN ORG_IMPL.SERVICE_PROVIDER_INFO_SAT_LATEST sps ON sps.SERVICE_PROVIDER_INFO_HKEY = sph.SERVICE_PROVIDER_HKEY
LEFT JOIN PTY.PARTY pty ON pty.PARTY_CODE = sps.PARTY_CODE
LEFT JOIN PTY_IMPL.PARTY_HUB ph ON ph.PARTY_CODE = pty.PARTY_CODE
LEFT JOIN PTY_IMPL.PARTY_INFO_SAT_LATEST ps ON ps.PARTY_INFO_HKEY = ph.PARTY_HKEY
LEFT JOIN ORG.APPLICATION_USER_CLAIM aucp ON aucp.VALUE = sps.PARTY_CODE
INNER JOIN ORG.APPLICATION_USER_CLAIM aucpi ON aucpi.APPLICATION_USER_ID = aucp.APPLICATION_USER_ID
WHERE 1=1
   AND aucp.CLAIM_TYPE = 'PartyCode' 
   AND aucpi.CLAIM_TYPE = 'IsUserActive' 
{{#if parameters.employeeCode}}
   AND sp.SERVICE_PROVIDER_CODE = @employeeCode
{{/if}}
{{#if parameters.partyCode}}
   AND pty.PARTY_CODE = @partyCode
{{/if}}
{{#if parameters.isUserActive}}
   AND aucp.VALUE = @isUserActive
{{/if}}
{{#if parameters.showDuplicates}}
   and ps.DUPLICATE_MASTER_NUMBER IS NOT NULL
{{else}}
   and ps.DUPLICATE_MASTER_NUMBER IS NULL
{{/if}}
