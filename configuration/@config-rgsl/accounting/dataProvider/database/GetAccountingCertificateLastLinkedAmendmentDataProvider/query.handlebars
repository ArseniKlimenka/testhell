SELECT
UNIVERSAL_VERSIONED_DOCUMENT_NUMBER AS DOCUMENT_NUMBER,
CODE_NAME,
CORRECTION_NUMBER
FROM (
	SELECT
	ud.UNIVERSAL_VERSIONED_DOCUMENT_NUMBER,
	ps.CODE_NAME,
	sat.CORRECTION_NUMBER,
	ROW_NUMBER() OVER (PARTITION BY sat.ORIGINAL_DOCUMENT_NUMBER ORDER BY ud.SEQ_NUMBER DESC) AS rowNum
	FROM bfx.UNIVERSAL_VERSIONED_DOCUMENT ud
	INNER JOIN ACC_IMPL.CRT_HUB hub
		ON hub.CERTIFICATE_NUMBER = ud.UNIVERSAL_VERSIONED_DOCUMENT_NUMBER
	INNER JOIN ACC_IMPL.CRT_SAT_LATEST sat
		ON sat.CRT_HKEY = hub.CRT_HKEY
	INNER JOIN cfg.PROCESS_STATE ps
		ON ps.PROCESS_STATE_ID = ud.STATE_ID
	WHERE
		1=1
	{{#if parameters.origDocNumber}}
		AND sat.ORIGINAL_DOCUMENT_NUMBER = @origDocNumber
	{{/if}}
) p
WHERE p.rowNum = 1