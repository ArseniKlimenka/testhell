select
	s.PAIR_NO,
	s.IS_DEBIT,
	s.POST_DATE,
	ev.EVENT_DATE,
	a.GL_ACCOUNT_NO,
	s.SOURCE_DOCUMENT_NO,
	period.DESCRIPTION as PERIOD_DESC,
	s.SOURCE_CURRENCY_CODE,
	s.SOURCE_AMOUNT,
	s.ACCOUNTING_GROSS_AMOUNT,
	s.ACCOUNTING_AMOUNT_BT,
	s.CONTRACT_NO,
	s.MAIN_CONTRACT_NO,
	s.SOURCE_LINE_ID as RISK_CODE,
	aa.BALANCE_UNIT,
	tc1.TRANSACTION_CODE as TRANSACTION_CODE_1,
	aa.TRANSACTION_CODE_2,
	tt.DESCRIPTION as TRANSACTION_TYPE_DESC,
	ofr.OFR_CODE,
	sapa.SAP_GL_ACCOUNT_NO,
	aa.REGISTER,
	aa.COST_CENTER,
	aa.TRADING_PARTNER,
	aa.DOCUMENT_NO,
	aa.CANCELLED_DOCUMENT_NO,
	aa.AA_ORDER_NO,
	aa.XREF2,
	aa.PERSONAL_ACCOUNT_NUMBER,
	aa.BUSINESS_LINE,
	aa.CEDENTS_COUNTRY,
	aa.LOCAL_DIMENSION_1,
	aa.LOCAL_DIMENSION_2,
	ld3.LOCAL_DIMENSION_3_CODE,
	aa.PARTY_CODE,
	tdt.TRANSACTION_DOCUMENT_TYPE_CODE,
    avs.IS_LIFE,
    aa.COMMISSION_RATE
from
	acc.GL_SUBLEDGER_ENTRY s
	inner join acc.GL_ADDITIONAL_ATTRIBUTES aa on s.GL_ADDITIONAL_ATTRIBUTE_ID = aa.GL_ADDITIONAL_ATTRIBUTE_ID
	inner join ACC_IMPL.SAP_GL_ACCOUNT sapa on aa.SAP_GL_ACCOUNT_ID = sapa.SAP_GL_ACCOUNT_ID
	inner join acc.EVENT ev on s.EVENT_ID = ev.EVENT_ID
	inner join acc.GL_ACCOUNT a on s.GL_ACCOUNT_ID = a.GL_ACCOUNT_ID
	inner join acc_impl.PERIOD period on s.PERIOD_ID = period.PERIOD_ID
	left join ACC_IMPL.CT_TRANSACTION_DOCUMENT_TYPE tdt on aa.TRANSACTION_DOCUMENT_TYPE_ID = tdt.TRANSACTION_DOCUMENT_TYPE_ID
	left join ACC_IMPL.CT_TRANSACTION_CODE_1 tc1 on aa.TRANSACTION_CODE_1 = tc1.TRANSACTION_CODE_1_ID
	left join ACC_IMPL.TRANSACTION_TYPE tt on aa.TRANSACTION_TYPE_ID = tt.TRANSACTION_TYPE_ID
	left join ACC_IMPL.CT_LOCAL_DIMENSION_3 ld3 on aa.LOCAL_DIMENSION_3_ID = ld3.LOCAL_DIMENSION_3_ID
	left join ACC_IMPL.CT_OFR ofr on aa.OFR_ID = ofr.OFR_ID
    left join ACC.ATTRIBUTE_VALUE_SET avs on s.ATTRIBUTE_VALUE_SET_ID = avs.ATTRIBUTE_VALUE_SET_ID
where 1=1
{{#if parameters.contractNo}}
	and s.MAIN_CONTRACT_NO = @contractNo
{{/if}}
{{#if parameters.bankStatementItemIds}}
	and aa.BANK_STATEMENT_ITEM_ID in (@bankStatementItemIds)
{{/if}}
{{#if parameters.documentNo}}
	and aa.DOCUMENT_NO = @documentNo
{{/if}}
{{#if parameters.pairNoFrom}}
	and s.PAIR_NO >= @pairNoFrom
{{/if}}
order by ev.EVENT_DATE, s.PAIR_NO, s.PAIR_SEQ_NO
