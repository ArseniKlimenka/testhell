SELECT 

	c.CONTRACT_NUMBER DOCUMENT_NUMBER,

	c.SYS_CREATED_ON,
	pa.CODE_NAME CONTRACT_TYPE,
	ps.CODE_NAME CONTRACT_STATE,

	CASE
		 WHEN cfPs.CF_POLICY_HKEY IS NOT NULL 
		 THEN cfPs.PRODUCT_DESCRIPTION
		 ELSE cfQs.PRODUCT_DESCRIPTION
	END
	AS PRODUCT_DESCRIPTION,

	CASE
		 WHEN cfPs.CF_POLICY_HKEY IS NOT NULL 
		 THEN cfPs.CF_POLICY
		 ELSE cfQs.CF_POLICY
	END
	AS CREATED_FROM_POLICY,

	CASE
		 WHEN cfPs.CF_POLICY_HKEY IS NOT NULL 
		 THEN cfPs.CF_POLICY_ORIGINAL
		 ELSE cfQs.CF_POLICY_ORIGINAL
	END
	AS CREATED_FROM_POLICY_ORIGINAL

FROM pas.contract c
LEFT JOIN PAS_IMPL.QUOTE_HUB qh ON qh.CONTRACT_NUMBER = c.CONTRACT_NUMBER
LEFT JOIN PAS_IMPL.CF_QUOTE_SAT cfQs ON cfQs.CF_QUOTE_HKEY = qh.QUOTE_HKEY
LEFT JOIN PAS_IMPL.POLICY_HUB ph ON ph.CONTRACT_NUMBER = c.CONTRACT_NUMBER
LEFT JOIN PAS_IMPL.CF_POLICY_SAT cfPs ON cfPs.CF_POLICY_HKEY = ph.POLICY_HKEY
LEFT JOIN CFX.PUBLISHED_ARTIFACT pa ON pa.PUBLISHED_ARTIFACT_ID = c.PUBLISHED_ARTIFACT_ID
LEFT JOIN CFG.PROCESS_STATE ps ON ps.PROCESS_STATE_ID = c.STATE_ID

WHERE (cfQs.CF_QUOTE_HKEY IS NOT NULL OR cfPs.CF_POLICY_HKEY IS NOT NULL) AND
	(cfQs.CF_POLICY_ORIGINAL = @contractNumber OR cfPs.CF_POLICY_ORIGINAL = @contractNumber)

ORDER BY c.SYS_CREATED_ON DESC 
