SELECT ctr.CONTRACT_NUMBER AS CANCELLATION_NUMBER,
	   art.CODE_NAME AS CONF_CODE_NAME
FROM PAS.CONTRACT ctr
JOIN PAS_IMPL.AMENDMENT_HUB amHub ON ctr.CONTRACT_NUMBER = amHub.AMENDMENT_NUMBER
JOIN PAS_IMPL.AMENDMENT_SAT_LATEST aSat ON aSat.AMENDMENT_HKEY = amHub.AMENDMENT_HKEY
JOIN CFX.PUBLISHED_ARTIFACT art ON art.PUBLISHED_ARTIFACT_ID = ctr.PUBLISHED_ARTIFACT_ID
JOIN CFG.PROCESS_STATE st ON st.PROCESS_STATE_ID = ctr.STATE_ID
WHERE 
st.CODE_NAME = 'AwaitingCancellationDate'
AND aSat.VALID_FROM <= @currentDate