select
  agh.CONTRACT_NUMBER,
  pst.CODE_NAME STATE,
  art.CODE_NAME,
  1 IS_POLICY
from
  PAS.CONTRACT agr,
  CFX.PUBLISHED_ARTIFACT art,
  CFG.PROCESS_STATE pst,
  PAS_IMPL.POLICY_HUB agh,
  PAS_IMPL.POLICY_SAT_LATEST ags,
  BFX_IMPL.PRODUCT_CONF cnf
where agr.PUBLISHED_ARTIFACT_ID = art.PUBLISHED_ARTIFACT_ID
  and agr.STATE_ID = pst.PROCESS_STATE_ID
  and agr.CONTRACT_NUMBER = agh.CONTRACT_NUMBER
  and agh.POLICY_HKEY = ags.POLICY_HKEY
  and ags.PRODUCT_CODE = cnf.PRODUCT_CODE
  and cnf.IS_PRODUCT_LINKED_TO_ASSET = 1
  and pst.CODE_NAME in ('Draft', 'Active')
  and DATEDIFF(day, ags.ISSUE_DATE, GETDATE()) >= 7
union
select
  agh.CONTRACT_NUMBER,
  pst.CODE_NAME STATE,
  art.CODE_NAME,
  0 IS_POLICY
from
  PAS.CONTRACT agr,
  CFX.PUBLISHED_ARTIFACT art,
  CFG.PROCESS_STATE pst,
  PAS_IMPL.QUOTE_HUB agh,
  PAS_IMPL.QUOTE_SAT_LATEST ags,
  BFX_IMPL.PRODUCT_CONF cnf
where agr.PUBLISHED_ARTIFACT_ID = art.PUBLISHED_ARTIFACT_ID
  and agr.STATE_ID = pst.PROCESS_STATE_ID
  and agr.CONTRACT_NUMBER = agh.CONTRACT_NUMBER
  and agh.QUOTE_HKEY = ags.QUOTE_HKEY
  and ags.PRODUCT_CODE = cnf.PRODUCT_CODE
  and cnf.IS_PRODUCT_LINKED_TO_ASSET = 1
  and pst.CODE_NAME in ('Draft', 'Approved')
  and DATEDIFF(day, ags.ISSUE_DATE, GETDATE()) >= 7