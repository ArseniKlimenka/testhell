SELECT
	aph.DOCUMENT_NUMBER,
	qh.CONTRACT_NUMBER CONTRACT_NUMBER,
	paQuote.CODE_NAME
FROM BFX_IMPL.ADDITIONAL_PARAMETERS_HUB aph
LEFT JOIN BFX_IMPL.ADDITIONAL_PARAMETERS_QUOTE_LINK apql ON apql.ADDITIONAL_PARAMETERS_HKEY = aph.ADDITIONAL_PARAMETERS_HKEY
LEFT JOIN PAS_IMPL.QUOTE_HUB qh ON qh.QUOTE_HKEY = apql.QUOTE_HKEY
LEFT JOIN PAS.CONTRACT quote ON quote.CONTRACT_NUMBER = qh.CONTRACT_NUMBER
LEFT JOIN CFX.PUBLISHED_ARTIFACT paQuote ON paQuote.PUBLISHED_ARTIFACT_ID = quote.PUBLISHED_ARTIFACT_ID
WHERE 1=1
{{#if parameters.documentNumber}}
    AND qh.CONTRACT_NUMBER = @documentNumber
{{/if}}

UNION

SELECT
	aph.DOCUMENT_NUMBER,
	ph.CONTRACT_NUMBER CONTRACT_NUMBER,
	paPolicy.CODE_NAME
FROM BFX_IMPL.ADDITIONAL_PARAMETERS_HUB aph
LEFT JOIN BFX_IMPL.ADDITIONAL_PARAMETERS_POLICY_LINK appl ON appl.ADDITIONAL_PARAMETERS_HKEY = aph.ADDITIONAL_PARAMETERS_HKEY
LEFT JOIN PAS_IMPL.POLICY_HUB ph ON ph.POLICY_HKEY = appl.POLICY_HKEY
LEFT JOIN PAS.CONTRACT policy ON policy.CONTRACT_NUMBER = ph.CONTRACT_NUMBER
LEFT JOIN CFX.PUBLISHED_ARTIFACT paPolicy ON paPolicy.PUBLISHED_ARTIFACT_ID = policy.PUBLISHED_ARTIFACT_ID
WHERE 1=1
{{#if parameters.documentNumber}}
    AND ph.CONTRACT_NUMBER = @documentNumber
{{/if}}