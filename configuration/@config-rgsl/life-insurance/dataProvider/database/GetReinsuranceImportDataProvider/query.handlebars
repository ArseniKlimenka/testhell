SELECT 
	r.REINSURANCE_ROW_ID, 
	r.IMPORT_DOCUMENT_ID, 
	r.CONTRACT_NUMBER, 
	r.POLICY_YEAR_NUMBER, 
	r.REINSURER_SHARE, 
	r.REINSURER_CODE, 
	r.REINSURANCE_NUMBER, 
	r.VERSION,
	pis.FULL_NAME,
	sph.SERVICE_PROVIDER_CODE
FROM PAS_IMPL.REINSURANCE r
LEFT JOIN ORG_IMPL.SERVICE_PROVIDER_INFO_SAT_LATEST spis on spis.PARTNER_CODE = CAST(r.REINSURER_CODE as nvarchar)
LEFT JOIN ORG_IMPL.SERVICE_PROVIDER_HUB sph on sph.SERVICE_PROVIDER_HKEY = spis.SERVICE_PROVIDER_INFO_HKEY
LEFT JOIN PTY_IMPL.PARTY_HUB ph on ph.PARTY_CODE = spis.PARTY_CODE
LEFT JOIN PTY_IMPL.PARTY_INFO_SAT_LATEST pis on pis.PARTY_INFO_HKEY = ph.PARTY_HKEY
WHERE 1 = 1
{{#if parameters.maxVersion}}
AND VERSION = (SELECT MAX(VERSION) MAX_VERSION FROM PAS_IMPL.REINSURANCE)
{{/if}}
{{#if parameters.importDocumentId}}
AND IMPORT_DOCUMENT_ID = @importDocumentId
{{/if}}
{{#if parameters.contractNumber}}
AND CONTRACT_NUMBER = @contractNumber
{{/if}}
{{#if parameters.contractNumberByMaxVersion}}
AND CONTRACT_NUMBER = @contractNumber AND VERSION = (SELECT MAX(VERSION) FROM PAS_IMPL.REINSURANCE rB WHERE rB.POLICY_YEAR_NUMBER = r.POLICY_YEAR_NUMBER) 
{{/if}}
AND spis.CONFIGURATION_CODE_NAME = 'Reinsurer'